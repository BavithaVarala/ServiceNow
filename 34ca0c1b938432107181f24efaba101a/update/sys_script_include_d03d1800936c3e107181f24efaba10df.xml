<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>x_801257_ets_trans.EapItemsDeepCopy</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description/>
        <mobile_callable>false</mobile_callable>
        <name>EapItemsDeepCopy</name>
        <sandbox_callable>false</sandbox_callable>
        <script><![CDATA[var EapItemsDeepCopy = Class.create();
EapItemsDeepCopy.prototype = Object.extendsObject(global.DeepCopy, {

    initialize: function(current) {
        if (!current) {
            gs.error("EapItemDeepCopy: current record is required");
            return;
        }

        this.current = current;
        var tableName = current.getTableName();

        // Log record initialization
        gs.debug("EapItemDeepCopy initialized for record: " + current.getValue('number') + ", table: " + tableName);

        // Default state for copied record (example: Funnel)
        this.parentStateVal = 'funnel';

        // System property for fields to copy
        var propName = "";
        if (tableName === 'sn_align_core_feature') {
            propName = "x_801257_ets_trans.copy.feature.fields";
        } else if (tableName === 'sn_align_core_scrum_epic') {
            propName = "x_801257_ets_trans.copy.epic.fields";
        }

        gs.debug("Using system property for fields to copy: " + propName);

        this.parentFieldsToCopy = [];
        if (!gs.nil(propName)) {
            var fieldsProp = gs.getProperty(propName, "");
            gs.debug("Fields property value: " + fieldsProp);

            if (!gs.nil(fieldsProp)) {
                // Validate each field
                this.parentFieldsToCopy = fieldsProp.split(",")
                    .map(function(f) { return f.trim(); })
                    .filter(function(f) { return f.length > 0; })
                    .filter(function(f) {
                        if (current.isValidField(f)) {
                            return true;
                        } else {
                            gs.debug("EapItemDeepCopy: invalid field skipped: " + f + " for record " + current.getValue('number'));
                            return false;
                        }
                    });

                gs.debug("Validated fields to copy: " + this.parentFieldsToCopy.join(", "));
            }
        }

        // No child tables for copy
        this.childTablesConfig = [];
    },

    showCopyAction: function(current) {
        if (!current || !current.canCreate()) {
            gs.debug("showCopyAction: user cannot create or record is null");
            return false;
        }

        gs.debug("showCopyAction: copy button allowed for record " + current.getValue('number'));
        return true;
    },

    deepCopy: function(current) {
        if (!current) {
            gs.debug("deepCopy: current record is null");
            return null;
        }

        gs.debug("deepCopy: starting copy for record " + current.getValue('number'));

        var result = {};
        var newParentID = this.copySingleRecord(
            current,
            this.parentFieldsToCopy,
            this.parentStateVal
        );

        if (gs.nil(newParentID)) {
            gs.debug("deepCopy: copy failed, newParentID is null");
            return null;
        }

        gs.debug("deepCopy: new record created with sys_id = " + newParentID);

        result.newRecordLink = current.getTableName() + ".do?sys_id=" + newParentID;
        result.newRecordID = newParentID;

        gs.debug("deepCopy: result object = " + JSON.stringify(result));

        return result;
    },

    type: 'EapItemsDeepCopy'
});
]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-10-07 15:40:39</sys_created_on>
        <sys_id>d03d1800936c3e107181f24efaba10df</sys_id>
        <sys_mod_count>7</sys_mod_count>
        <sys_name>EapItemsDeepCopy</sys_name>
        <sys_package display_value="ETS Transformation" source="x_801257_ets_trans">34ca0c1b938432107181f24efaba101a</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="ETS Transformation">34ca0c1b938432107181f24efaba101a</sys_scope>
        <sys_update_name>sys_script_include_d03d1800936c3e107181f24efaba10df</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-10-17 20:29:19</sys_updated_on>
    </sys_script_include>
</record_update>
