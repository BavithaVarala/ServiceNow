<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_ui_action">
    <sys_ui_action action="INSERT_OR_UPDATE">
        <action_name>add_to_current_iteration</action_name>
        <active>true</active>
        <client>false</client>
        <client_script_v2><![CDATA[function onClick(g_form) {

}]]></client_script_v2>
        <comments>Error MessageâŒ Story creation failed: Story reassigned to new team</comments>
        <condition>(new IncidentStoryIterationHelper()).showAction(current)</condition>
        <form_action>true</form_action>
        <form_button>true</form_button>
        <form_button_v2>false</form_button_v2>
        <form_context_menu>false</form_context_menu>
        <form_link>false</form_link>
        <form_menu_button_v2>false</form_menu_button_v2>
        <form_style/>
        <format_for_configurable_workspace>false</format_for_configurable_workspace>
        <hint/>
        <isolate_script>false</isolate_script>
        <list_action>false</list_action>
        <list_banner_button>false</list_banner_button>
        <list_button>false</list_button>
        <list_choice>false</list_choice>
        <list_context_menu>false</list_context_menu>
        <list_link>false</list_link>
        <list_save_with_form_button>false</list_save_with_form_button>
        <list_style/>
        <messages/>
        <name>Add to Current Iteration</name>
        <onclick/>
        <order>100</order>
        <script><![CDATA[(function executeAction(current) {
    var util = new IncidentStoryIterationHelper();
    var result = util.createStoryInTeamIteration(current.sys_id.toString(), current.getTableName());

    if (result.success) {
        // Build hyperlink if sys_id exists
        var storyLink = result.sys_id
            ? '<a href="#" onclick="window.open(\'/rm_story.do?sys_id=' + result.sys_id + '\', \'_blank\'); return false;">' + result.storyNumber + '</a>'
            : result.storyNumber;

        var teamText = result.teamName ? ' for team ' + result.teamName : '';
        var iterationText = result.iterationName ? ' in iteration ' + result.iterationName : '';
        var backlogText = !result.iterationName ? ' (no iteration, added to backlog)' : '';

        var message = '';

        switch (result.status) {
            case 'same_team':
                message = 'â„¹ï¸ Story ' + storyLink + iterationText + teamText + ' already exists' + backlogText + '.';
                break;

            case 'reassigned':
                message = ']]>ğŸ”„<![CDATA[ Story ' + storyLink + iterationText + teamText + ' reassigned successfully' + backlogText + '.';
                break;

            case 'iteration_updated':
                if (result.iterationName) {
                    message = ']]>ğŸ”<![CDATA[ Story ' + storyLink + iterationText + teamText + ' updated to current iteration.';
                } else {
                    // No iteration exists â†’ backlog
                    message = 'âš ï¸ Story ' + storyLink + ' created in backlog' + teamText + '.';
                }
                break;

            case 'backlog':
                message = 'âš ï¸ Story ' + storyLink + ' created in backlog' + teamText + '.';
                break;

            default:
                message = 'âœ… Story ' + storyLink + iterationText + backlogText + teamText + ' created successfully.';
        }

        // Add info message in UI (clickable link opens in new tab)
        gs.addInfoMessage(message);

        // Add work notes (strip HTML)
        if (current.isValidField('work_notes')) {
            current.work_notes = message.replace(/<[^>]+>/g, '');
            current.update();
        }

    } else {
        // Handle failure
        var failMessage = 'âŒ Story creation failed: ' + (result.message || 'Unknown error');

        if (result.message === 'Team does not exist') {
            failMessage = 'âŒ Story creation failed: Team does not exist. Please check team mapping.';
        }

        gs.addErrorMessage(failMessage);

        if (current.isValidField('work_notes')) {
            current.work_notes = failMessage;
            current.update();
        }
    }

    return true;
})(current);
]]></script>
        <show_insert>true</show_insert>
        <show_multiple_update>false</show_multiple_update>
        <show_query>false</show_query>
        <show_update>true</show_update>
        <sys_class_name>sys_ui_action</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-09-22 20:14:55</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>441c489b938432107181f24efaba1015</sys_id>
        <sys_mod_count>66</sys_mod_count>
        <sys_name>Add to Current Iteration</sys_name>
        <sys_overrides/>
        <sys_package display_value="ETS Transformation" source="x_801257_ets_trans">34ca0c1b938432107181f24efaba101a</sys_package>
        <sys_policy/>
        <sys_scope display_value="ETS Transformation">34ca0c1b938432107181f24efaba101a</sys_scope>
        <sys_update_name>sys_ui_action_441c489b938432107181f24efaba1015</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-10-17 20:49:48</sys_updated_on>
        <table>incident</table>
        <ui11_compatible>true</ui11_compatible>
        <ui16_compatible>false</ui16_compatible>
    </sys_ui_action>
</record_update>
