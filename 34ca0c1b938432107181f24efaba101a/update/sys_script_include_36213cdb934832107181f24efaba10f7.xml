<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>x_801257_ets_trans.Agile_Multi_Task_AjaxProcessor</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description/>
        <mobile_callable>false</mobile_callable>
        <name>Agile_Multi_Task_AjaxProcessor</name>
        <sandbox_callable>false</sandbox_callable>
        <script><![CDATA[var Agile_Multi_Task_AjaxProcessor = Class.create();
Agile_Multi_Task_AjaxProcessor.prototype = Object.extendsObject(global.AbstractAjaxProcessor, {

	addRecordsToBacklog: function() {
		gs.info('##Triage: Ajax Processor - Starting addRecordsToBacklog()');
		var result = this.newItem('result');
		var gr = new GlideRecord('rm_story');
		if(!gr.canCreate()) {
			gs.info('##Triage: Ajax Processor - No permission to create stories');
			result.setAttribute('status', 'error');
			result.setAttribute('message', 'You do not have access to create story.');
			return 'false';
		}
		var records = this.getParameter('sysparm_records');
		var tableName = this.getParameter('sysparm_table_name');
		var backlogDefinition = this.getParameter('sysparm_backlog_definition');
		
		gs.info('##Triage: Ajax Processor - Parameters: records=' + records + ', table=' + tableName + ', backlog=' + backlogDefinition);
		
		var backlogReocord = new GlideRecord('backlog_definition');
		if (!backlogReocord.get(backlogDefinition)) {
			gs.info('##Triage: Ajax Processor - Backlog definition not found: ' + backlogDefinition);
			result.setAttribute('status', 'error');
			result.setAttribute('message', 'Backlog definition not found.');
			return 'false';
		}
		
		var backlogQuery = backlogReocord.filter;
		gs.info('##Triage: Ajax Processor - Backlog query: ' + backlogQuery);

		var taskRecord = new GlideRecord(tableName);
		taskRecord.addQuery('sys_id', 'IN', records);
		taskRecord.addNullQuery('agile_story');
		taskRecord.query();
		var totalCount = taskRecord.getRowCount();
		
		gs.info('##Triage: Ajax Processor - Found ' + totalCount + ' tasks to process');
		
		var satisfiedQueryCnt = 0;
		var storyIds = [];
		while(taskRecord.next()){
			gs.info('##Triage: Ajax Processor - Processing task: ' + taskRecord.sys_id + ' (' + taskRecord.short_description + ')');
			var storyRecord = new GlideRecord('rm_story');
			storyRecord.initialize();
			storyRecord.applyEncodedQuery(backlogQuery);
			storyRecord.short_description = taskRecord.short_description;
			storyRecord.backlog_definition = backlogDefinition;
			storyRecord.original_task = taskRecord.sys_id;
			var sysId = storyRecord.insert();
			if(sysId) {
				var story = new GlideRecord('rm_story');
				if(story.get(sysId) && GlideFilter.checkRecord(story, backlogQuery)){
					satisfiedQueryCnt++;
				}
				storyIds.push(sysId);
				taskRecord.setValue('agile_story', sysId);
				taskRecord.setWorkflow(false);
				taskRecord.update();
			}
		}
		result.setAttribute('status', 'success');
		result.setAttribute('backlogId', backlogDefinition);
		result.setAttribute('totalCount', totalCount);
		result.setAttribute('satisfiedQueryCnt', satisfiedQueryCnt);
		result.setAttribute('storyIds', storyIds.join());
		return 'true';
	},

	type: 'Agile_Multi_Task_AjaxProcessor'
});]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-09-22 22:56:36</sys_created_on>
        <sys_id>36213cdb934832107181f24efaba10f7</sys_id>
        <sys_mod_count>1</sys_mod_count>
        <sys_name>Agile_Multi_Task_AjaxProcessor</sys_name>
        <sys_package display_value="ETS Transformation" source="x_801257_ets_trans">34ca0c1b938432107181f24efaba101a</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="ETS Transformation">34ca0c1b938432107181f24efaba101a</sys_scope>
        <sys_update_name>sys_script_include_36213cdb934832107181f24efaba10f7</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-09-22 23:05:05</sys_updated_on>
    </sys_script_include>
</record_update>
